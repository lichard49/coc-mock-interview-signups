<!DOCTYPE html>
<html>
  <head lang="en">
    <title>Georgia Tech College of Computing Mock Interview Sign Ups</title>

    <!-- Foundation -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.2/css/foundation.css">
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.2/js/foundation.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.js"></script>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Slick slider -->
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/jquery.slick/1.5.9/slick.css"/>
    <script type="text/javascript" src="//cdn.jsdelivr.net/jquery.slick/1.5.9/slick.min.js"></script>

    <!-- Firebase -->
    <script src="https://cdn.firebase.com/js/client/2.3.2/firebase.js"></script>

    <!-- My stuff -->
    <link rel="stylesheet" href="style.css">
  </head>

  <body>
    <div class="row">
      <div class="medium-12 columns">

        <br>
        <h3 class="left">Georgia Tech College of Computing<br>Mock Interview Sign Ups</h3>
        <img src="https://per.gatech.edu/wiki/lib/exe/fetch.php?cache=&w=600&h=590&media=wiki:buzz.png" class="logo right"/>

        <hr>

        <div id="step-slider">
          <div>
            <p>Step 1. Choose a time and interviewer.</p>
            <table id="calendar" border="1" style="width:100%">
            </table>
          </div>
          <div>
            <p>Step 2. Tell us about yourself.</p>
              <div class="row">
                <div class="large-12 columns">
                  <label>
                    Name (required)
                    <input type="text" id="name" placeholder="John Smith">
                  </label>
                </div>
              </div>
              <div class="row">
                <div class="large-12 columns">
                  <label>
                    Georgia Tech Email (required)
                    <input type="text" id="email" placeholder="jsmith4@gatech.edu">
                  </label>
                </div>
              </div>
              <div class="row">
                <div class="large-12 columns">
                  <label>
                    Anything else (optional)
                    <textarea id="other" placeholder="I want to practice linked lists for my interview next week"></textarea>
                  </label>
                </div>
              </div>
              <div class="row">
                <div class="large-12 columns">
                  <button id="back-step" class="button left">Back</button>
                  <button id="next-step" class="button right">Confirm</button>
                </div>
              </div>
          </div>
          <div>
            <p>Step 3. You're all done!</p>
            <p>Thanks, <b id="name-space"></b>.&nbsp;&nbsp;Please come to CoC 358 at <b id="hour-space"></b> on <b id="day-space"></b> for your mock interview with <b id="interviewer-space"></b>.
          </div>
        </div>

        <hr>
        <p>Brought to you by Georgia Tech Technical Interview Prep (GT TIP).&nbsp;&nbsp;<a href="https://www.facebook.com/gttechintprep">Like us on Facebook!</a></p>
        <p>Questions?&nbsp;&nbsp;Email us at <a href="mailto:coctechintv@gatech.edu" target="_top">coctechintv@gatech.edu</a>.</p>

      </div>
    </div>

    <script type="text/javascript">

      var firebase
      var selectedDay;
      var selectedTime;
      var selectedInterviewer;

      function buildCalendar() {
        var days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
        var hours = ['9:00AM', '10:00AM', '11:00AM', '12:00PM', '1:00PM', '2:00PM', '3:00PM', '4:00PM', '5:00PM'];
        
        var calendarContents = '<tr><th></th>';
        var day;
        for(day in days) {
          calendarContents += '<th>' + days[day] + '</th>';
        }
        calendarContents += '</tr>'

        var hour;
        for(hour in hours) {
          calendarContents += '<tr><td class="firstColumn">' + hours[hour] + '</td>';
          for(day in days) {
            calendarContents += '<td id="' + days[day] + '-' + hours[hour] + '"></td>';
          }
          calendarContents += '</tr>';
        }

        return calendarContents;
      }

      function escapeSelector( selector ) {
        return selector.replace( /(:|\.|\[|\]|,)/g, "\\$1" );
      }

      function newData(snapshot) {
        snapshot.forEach(function(daySnapshot) {
          daySnapshot.forEach(function(hourSnapshot) {
            var day = daySnapshot.key();
            var hour = hourSnapshot.key();
            var cellContents = '';

            hourSnapshot.forEach(function(personSnapshot) {
              if(personSnapshot.val() == 'available') {
                var person = personSnapshot.key();
                cellContents += '<button id="' + day + '-' + hour + '-' + person + '"class="interviewer">' + person + '</button>';
              }
            });

            $('#'+escapeSelector(day + '-' + hour)).html(cellContents);

            $('.interviewer').on('click', function(e) {
              var selectedDetails = this.id.split('-');
              selectedDay = selectedDetails[0];
              selectedTime = selectedDetails[1];
              selectedInterviewer = selectedDetails[2];
              $('.slick-next').click();
            });
          });
        });
      }

      function validateEmail(email) {
        var re = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(email);
      }

      function validateForm() {
        // clear previous errors
        $('.error').remove();

        var name = $('#name').val();
        var email = $('#email').val();
        var gatechDomain = 'gatech.edu';
        var valid = true;

        if(name.length == 0) {
          $('#name').after('<small class="error">Name is required</small>');
          valid = false;
        }
        if(email.length == 0) {
          $('#email').after('<small class="error">Email is required</small>');
          valid = false;
        }
        else if(!validateEmail(email)) {
          $('#email').after('<small class="error">Email is invalid</small>');
          valid = false;
        }
        else if(email.indexOf(gatechDomain) != email.length-gatechDomain.length) {
          $('#email').after('<small class="error">Not a Georgia Tech email</small>');
          valid = false;
        }
        return valid;
      }

      function confirm() {
        var intervieweeName = $('#name').val();
        var intervieweeEmail = $('#email').val();
        var intervieweeOther = $('#other').val();

        $('#name-space').html(intervieweeName);
        $('#day-space').html(selectedDay);
        $('#hour-space').html(selectedTime);
        $('#interviewer-space').html(selectedInterviewer);

        firebase.child('week').child(selectedDay).child(selectedTime).child(selectedInterviewer).set({interviewee: intervieweeName, email: intervieweeEmail, other: intervieweeOther});
      }

      $(document).ready(function() {        
        $('#calendar').html(buildCalendar());

        $('#step-slider').slick({
          swipe: false
        });

        firebase = new Firebase('https://coc-mock-interviews.firebaseio.com/');
        firebase.child('week').on('value', newData);

        $('#next-step').click(function() {
          if(validateForm()) {
            confirm();
            $('.slick-next').click();
          }
        });
        $('#back-step').click(function() { $('.slick-prev').click(); });
      });
    </script>
  </body>
</html>